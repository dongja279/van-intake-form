<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>VAN êµì²´ ê²¬ì  ìš”ì²­</title>
  <style>
    :root{--bg:#0b0b0b;--card:#151515;--ink:#f5f5f5;--muted:#b9b9b9;--accent:#3aa0ff}
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Malgun Gothic,sans-serif}
    .wrap{max-width:720px;margin:0 auto;padding:20px}
    .banner{background:linear-gradient(180deg,#1f2937,#111827);border:1px solid #2a2a2a;border-radius:16px;padding:16px 14px;margin-bottom:14px}
    .banner strong{display:block;font-size:15px;line-height:1.4}
    .banner .small{color:var(--muted);font-size:12px;margin-top:8px}
    .card{background:var(--card);border:1px solid #2a2a2a;border-radius:16px;padding:16px}
    .title{font-size:18px;margin:0 0 8px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    label{display:block;font-size:13px;color:var(--muted);margin:12px 0 6px}
    input,select,button,textarea{width:100%;padding:14px 12px;border-radius:12px;border:1px solid #2b2b2b;background:#0f0f10;color:var(--ink);font-size:15px;outline:none}
    input::placeholder{color:#8d8d8d}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .pill{display:inline-flex;gap:6px;background:#0f0f10;border:1px solid #2b2b2b;padding:6px 10px;border-radius:999px;align-items:center}
    .section{margin-top:8px}
    .hide{display:none}
    .actions{display:flex;gap:10px;margin-top:16px}
    .primary{background:var(--accent);border:1px solid #348fe3;font-weight:600}
    .ghost{background:#0f0f10;border:1px dashed #3a3a3a}
    .help{font-size:12px;color:#8a8a8a;margin-top:6px}
    .ok{color:#c7ffea}.err{color:#ffb6b6}
    footer{margin:28px 0 8px;color:#7b7b7b;font-size:12px;text-align:center}
    .hgroup{margin-top:18px;border-top:1px dashed #2a2a2a;padding-top:12px}
    .hgroup h3{margin:0 0 6px;font-size:15px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="banner">
      <strong>ì•„ë˜ ì •ë³´ë¥¼ ì…ë ¥ í•´ ì£¼ì‹œë©´ ê²¬ì  ì‚°ì¶œ í›„ ì¼ì£¼ì¼ ë‚´ë¡œ ì—°ë½ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</strong>
      <div class="small">ë¬¸ì˜ : í•œêµ­ê²°ì œì†”ë£¨ì…˜ ë°°ì¤€ì²  ëŒ€í‘œ 010-4180-8867</div>
    </div>

    <div class="card">
      <h2 class="title">VAN êµì²´ ì ì¬ê³ ê° ì…ë ¥ í¼</h2>

      <!-- ì—…ì¢… ì„ íƒ -->
      <label for="bizType">ì—…ì¢… ì„ íƒ</label>
      <div class="row" role="radiogroup" aria-label="ì—…ì¢… ì„ íƒ">
        <button class="pill" type="button" data-type="ì‹ë‹¹" id="btn-food"><span>ğŸ½ï¸</span><span>ì‹ë‹¹</span></button>
        <button class="pill" type="button" data-type="ë³‘ì›" id="btn-hospital"><span>ğŸ¥</span><span>ë³‘ì›</span></button>
      </div>
      <input type="hidden" id="bizType" value="ì‹ë‹¹"/>

      <!-- ì‹ë‹¹ ì„¹ì…˜(ê¸°ì¡´ ìœ ì§€) -->
      <div id="foodSection" class="section">
        <label>ì—…ì²´ëª…</label>
        <input id="f_name" type="text" placeholder="ì˜ˆ) í•œêµ­ê²°ì œë„¤íŠ¸ì›ìŠ¤ ê°•ë‚¨ì " required />
        <label>ë‹´ë‹¹ìëª…</label>
        <input id="f_person" type="text" placeholder="ì˜ˆ) í™ê¸¸ë™" />
        <label>ì—°ë½ì²˜</label>
        <input id="f_phone" type="tel" inputmode="numeric" placeholder="010-0000-0000" pattern="^01[016789]-\\d{3,4}-\\d{4}$" />
        <div class="help">í˜•ì‹ ì˜ˆ: 010-1234-5678</div>

        <label>ê¸°ì¡´ ì‚¬ìš© ì¤‘ì¸ í¬ìŠ¤í”„ë¡œê·¸ë¨ì€?</label>
        <input id="f_pos" type="text" placeholder="ì˜ˆ) ì˜¤ì¼€ì´í¬ìŠ¤" />

        <label>ê¸°ì¡´ í¬ìŠ¤ ì—…ì²´ì™€ ê³„ì•½ê¸°ê°„</label>
        <div class="grid-2">
          <input id="f_contract_s" type="date" />
          <input id="f_contract_e" type="date" />
        </div>

        <label>ìœ„ì•½ê¸ˆ(ìµì›” ë§ ê¸°ì¤€)</label>
        <input id="f_penalty" type="number" min="0" step="1" placeholder="ì²œì› ë‹¨ìœ„ ì˜ˆ) 300" />
        <div class="help">ë‹¨ìœ„: ì²œì›</div>

        <label>í¬ìŠ¤ê¸° ëŒ€ìˆ˜(ë©”ì¸í¬ìŠ¤, ì˜¤ë”í¬ìŠ¤ ë“±)</label>
        <input id="f_poscnt" type="number" min="0" step="1" placeholder="ì˜ˆ) 2" />

        <label>ì „ë…„ë„ ê¸°ì¤€ ì¹´ë“œë§¤ì¶œ ì´ì•¡</label>
        <input id="f_sales_amt" type="number" min="0" step="1" placeholder="ë°±ë§Œì› ë‹¨ìœ„ ì˜ˆ) 850" />
        <div class="help">ë‹¨ìœ„: ë°±ë§Œì›</div>

        <label>ì „ë…„ë„ ê¸°ì¤€ ì¹´ë“œë§¤ì¶œ ê±´ ìˆ˜</label>
        <input id="f_sales_cnt" type="number" min="0" step="1" placeholder="ì˜ˆ) 12450" />
      </div>

      <!-- ë³‘ì› ì„¹ì…˜(ì‹ ê·œ êµ¬ì„±) -->
      <div id="hospitalSection" class="section hide">
        <!-- 1. ë³‘ì›ì •ë³´ -->
        <div class="hgroup">
          <h3>1) ë³‘ì›ì •ë³´</h3>
          <label>ì—…ì²´ëª…</label>
          <input id="h_name" type="text" placeholder="ì˜ˆ) í•œêµ­ì˜ì›" />
          <label>ì‚¬ì—…ì ë“±ë¡ ë²ˆí˜¸</label>
          <input id="h_bizno" type="text" inputmode="numeric" placeholder="ì˜ˆ) 123-45-67890" pattern="^\\d{3}-\\d{2}-\\d{5}$" />
          <div class="help">í˜•ì‹: 123-45-67890</div>
          <label>ë‹´ë‹¹ìëª…</label>
          <input id="h_person" type="text" placeholder="ì˜ˆ) ê¹€ì›ì¥" />
          <label>ì—°ë½ì²˜</label>
          <input id="h_phone" type="tel" inputmode="numeric" placeholder="010-0000-0000" pattern="^01[016789]-\\d{3,4}-\\d{4}$" />
        </div>

        <!-- 2. ê¸°ì¡´ EMR ì—…ì²´ ì •ë³´ -->
        <div class="hgroup">
          <h3>2) ê¸°ì¡´ EMR ì—…ì²´ ì •ë³´</h3>
          <label>ì—…ì²´ëª…</label>
          <input id="h_emr_name" type="text" placeholder="ì˜ˆ) â—‹â—‹EMR" />
          <label>ë‹´ë‹¹ìëª…</label>
          <input id="h_emr_person" type="text" placeholder="ì˜ˆ) ì´ë§¤ë‹ˆì €" />
          <label>ì—°ë½ì²˜</label>
          <input id="h_emr_phone" type="tel" inputmode="numeric" placeholder="010-0000-0000" pattern="^01[016789]-\\d{3,4}-\\d{4}$" />
          <label>EMR ì—…ì²´ ë³€ê²½ ê°€ëŠ¥ ì—¬ë¶€</label>
          <select id="h_emr_switch">
            <option value="">ì„ íƒ</option>
            <option>ê°€ëŠ¥</option>
            <option>ë¶ˆê°€</option>
            <option>ê²€í†  í•„ìš”</option>
          </select>
        </div>

        <!-- 3. ê¸°ì¡´ Van ì—…ì²´ ì •ë³´ -->
        <div class="hgroup">
          <h3>3) ê¸°ì¡´ Van ì—…ì²´ ì •ë³´</h3>
          <label>ì—…ì²´ëª…</label>
          <input id="h_van_name" type="text" placeholder="ì˜ˆ) í•œêµ­ê²°ì œë„¤íŠ¸ì›ìŠ¤" />
          <label>ê³„ì•½ê¸°ê°„</label>
          <div class="grid-2">
            <input id="h_van_contract_s" type="date" />
            <input id="h_van_contract_e" type="date" />
          </div>
          <label>ìœ„ì•½ê¸ˆ(ìµì›” ë§ ê¸°ì¤€)</label>
          <input id="h_van_penalty" type="number" min="0" step="1" placeholder="ì²œì› ë‹¨ìœ„ ì˜ˆ) 300" />
          <div class="help">ë‹¨ìœ„: ì²œì›</div>
        </div>

        <!-- 4. ì¹´ë“œ ë‹¨ë§ê¸°(ë¦¬ë”ê¸°) ì •ë³´ -->
        <div class="hgroup">
          <h3>4) ì¹´ë“œ ë‹¨ë§ê¸°(ë¦¬ë”ê¸°) ì •ë³´</h3>
          <label>ë‹¨ë§ê¸°(ë¦¬ë”ê¸°) ëŒ€ìˆ˜</label>
          <input id="h_reader_count" type="number" min="0" step="1" placeholder="ì˜ˆ) 3" />
        </div>

        <!-- 5. ì „ë…„ë„ ì¹´ë“œë§¤ì¶œ(VAT í¬í•¨) -->
        <div class="hgroup">
          <h3>5) ì „ë…„ë„ ì¹´ë“œë§¤ì¶œ(VAT í¬í•¨)</h3>
          <label>100ë§Œì› ì´í•˜ ê±´ ìˆ˜(ê±´)</label>
          <input id="h_under_cnt" type="number" min="0" step="1" placeholder="ì˜ˆ) 1200" />
          <label>100ë§Œì› ì´í•˜ ë§¤ì¶œ í•©ê³„(ë°±ë§Œ)</label>
          <input id="h_under_amt" type="number" min="0" step="1" placeholder="ì˜ˆ) 450" />
          <label>100ë§Œì› ì´ìƒ ê±´ ìˆ˜(ê±´)</label>
          <input id="h_over_cnt" type="number" min="0" step="1" placeholder="ì˜ˆ) 150" />
          <label>100ë§Œì› ì´ìƒ ë§¤ì¶œ í•©ê³„(ë°±ë§Œ)</label>
          <input id="h_over_amt" type="number" min="0" step="1" placeholder="ì˜ˆ) 320" />
        </div>
      </div>

      <!-- ì œì¶œ ì˜ì—­ -->
      <div class="actions">
        <button id="btnSubmit" class="primary" type="button">ì œì¶œ</button>
        <button id="btnDownload" class="ghost" type="button">CSVë¡œ ì €ì¥</button>
        <button id="btnCopy" class="ghost" type="button">JSON ë³µì‚¬</button>
      </div>

      <div id="result" class="help" aria-live="polite" style="margin-top:10px"></div>
    </div>

    <footer>Â© í•œêµ­ê²°ì œì†”ë£¨ì…˜ VAN íŒŒíŠ¸ë„ˆ</footer>
  </div>

  <script>
    // ì—…ì¢… í† ê¸€
    const bizTypeEl = document.getElementById('bizType');
    const foodSection = document.getElementById('foodSection');
    const hospitalSection = document.getElementById('hospitalSection');
    const btnFood = document.getElementById('btn-food');
    const btnHospital = document.getElementById('btn-hospital');
    function setType(t){
      bizTypeEl.value=t;
      if(t==='ì‹ë‹¹'){foodSection.classList.remove('hide');hospitalSection.classList.add('hide')}
      else{hospitalSection.classList.remove('hide');foodSection.classList.add('hide')}
      [btnFood,btnHospital].forEach(b=>b.style.borderColor='#2b2b2b');
      (t==='ì‹ë‹¹'?btnFood:btnHospital).style.borderColor='var(--accent)';
    }
    btnFood.onclick=()=>setType('ì‹ë‹¹');
    btnHospital.onclick=()=>setType('ë³‘ì›');

    // ë°ì´í„° ìˆ˜ì§‘
    function collect(){
      const type=bizTypeEl.value;
      const payload={ì—…ì¢…:type, ì œì¶œì‹œê°:new Date().toISOString()};
      if(type==='ì‹ë‹¹'){
        payload.ì—…ì²´ëª…=document.getElementById('f_name').value.trim();
        payload.ë‹´ë‹¹ìëª…=document.getElementById('f_person').value.trim();
        payload.ì—°ë½ì²˜=document.getElementById('f_phone').value.trim();
        payload.í¬ìŠ¤í”„ë¡œê·¸ë¨=document.getElementById('f_pos').value.trim();
        payload.ê³„ì•½ì‹œì‘=document.getElementById('f_contract_s').value;
        payload.ê³„ì•½ì¢…ë£Œ=document.getElementById('f_contract_e').value;
        payload.ìœ„ì•½ê¸ˆ_ì²œì›=Number(document.getElementById('f_penalty').value||0);
        payload.í¬ìŠ¤ê¸°_ëŒ€ìˆ˜=Number(document.getElementById('f_poscnt').value||0);
        payload.ì „ë…„ë„_ì¹´ë“œë§¤ì¶œ_ë°±ë§Œì›=Number(document.getElementById('f_sales_amt').value||0);
        payload.ì „ë…„ë„_ì¹´ë“œë§¤ì¶œ_ê±´ìˆ˜=Number(document.getElementById('f_sales_cnt').value||0);
      }else{
        // ë³‘ì›
        payload.ë³‘ì›ì •ë³´={
          ì—…ì²´ëª…: document.getElementById('h_name').value.trim(),
          ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸: document.getElementById('h_bizno').value.trim(),
          ë‹´ë‹¹ìëª…: document.getElementById('h_person').value.trim(),
          ì—°ë½ì²˜: document.getElementById('h_phone').value.trim()
        };
        payload.EMR_ì—…ì²´ì •ë³´={
          ì—…ì²´ëª…: document.getElementById('h_emr_name').value.trim(),
          ë‹´ë‹¹ìëª…: document.getElementById('h_emr_person').value.trim(),
          ì—°ë½ì²˜: document.getElementById('h_emr_phone').value.trim(),
          ë³€ê²½ê°€ëŠ¥ì—¬ë¶€: document.getElementById('h_emr_switch').value
        };
        payload.VAN_ì—…ì²´ì •ë³´={
          ì—…ì²´ëª…: document.getElementById('h_van_name').value.trim(),
          ê³„ì•½ì‹œì‘: document.getElementById('h_van_contract_s').value,
          ê³„ì•½ì¢…ë£Œ: document.getElementById('h_van_contract_e').value,
          ìœ„ì•½ê¸ˆ_ì²œì›: Number(document.getElementById('h_van_penalty').value||0)
        };
        payload.ë¦¬ë”ê¸°ì •ë³´={ ëŒ€ìˆ˜: Number(document.getElementById('h_reader_count').value||0) };
        payload.ì „ë…„ë„ì¹´ë“œë§¤ì¶œ={
          ë°±ë§Œì›ì´í•˜_ê±´ìˆ˜: Number(document.getElementById('h_under_cnt').value||0),
          ë°±ë§Œì›ì´í•˜_í•©ê³„_ë°±ë§Œ: Number(document.getElementById('h_under_amt').value||0),
          ë°±ë§Œì›ì´ìƒ_ê±´ìˆ˜: Number(document.getElementById('h_over_cnt').value||0),
          ë°±ë§Œì›ì´ìƒ_í•©ê³„_ë°±ë§Œ: Number(document.getElementById('h_over_amt').value||0)
        };
      }
      return payload;
    }

    // ê²€ì¦
    function validate(d){
      const phoneRe=/^01[016789]-\d{3,4}-\d{4}$/;
      const bizRe=/^\d{3}-\d{2}-\d{5}$/;
      if(d.ì—…ì¢…==='ì‹ë‹¹'){
        if(!d.ì—…ì²´ëª…) return 'ì—…ì²´ëª…ì€ í•„ìˆ˜';
        if(d.ì—°ë½ì²˜ && !phoneRe.test(d.ì—°ë½ì²˜)) return 'ì—°ë½ì²˜ í˜•ì‹ í™•ì¸';
      }else{
        if(!d.ë³‘ì›ì •ë³´.ì—…ì²´ëª…) return 'ë³‘ì› ì—…ì²´ëª…ì€ í•„ìˆ˜';
        if(d.ë³‘ì›ì •ë³´.ì—°ë½ì²˜ && !phoneRe.test(d.ë³‘ì›ì •ë³´.ì—°ë½ì²˜)) return 'ë³‘ì› ì—°ë½ì²˜ í˜•ì‹ í™•ì¸';
        if(d.ë³‘ì›ì •ë³´.ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ && !bizRe.test(d.ë³‘ì›ì •ë³´.ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸)) return 'ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ í˜•ì‹ í™•ì¸';
      }
      return '';
    }

    // ì œì¶œ(ì„ì‹œ: ì½˜ì†”)
    const resultEl=document.getElementById('result');
    document.getElementById('btnSubmit').onclick=async()=>{
      const data=collect();
      const err=validate(data);
      if(err){resultEl.innerHTML='<span class="err">ì˜¤ë¥˜: '+err+'</span>';return;}
      console.log('ì œì¶œ ë°ì´í„°:', data);
      resultEl.innerHTML='<span class="ok">ì œì¶œ ì¤€ë¹„ ì™„ë£Œ. í˜„ì¬ëŠ” ë¡œì»¬ ì €ì¥/ë³µì‚¬ë§Œ ì§€ì›í•©ë‹ˆë‹¤.</span>';
      // ì„œë²„ ì—°ê²° ì‹œ fetch POST ì¶”ê°€
    };

    // CSV ì €ì¥
    document.getElementById('btnDownload').onclick=()=>{
      const d=collect(); const err=validate(d); if(err){resultEl.innerHTML='<span class="err">ì˜¤ë¥˜: '+err+'</span>';return;}
      const flat=(obj,prefix='')=>{
        return Object.entries(obj).reduce((acc,[k,v])=>{
          const key=prefix?`${prefix}.${k}`:k;
          if(v && typeof v==='object' && !Array.isArray(v)) Object.assign(acc,flat(v,key));
          else acc[key]=v;
          return acc;
        },{});
      };
      const f=flat(d);
      const keys=Object.keys(f);
      const csv=[keys.join(','), keys.map(k=>JSON.stringify(f[k] ?? '')).join(',')].join('\n');
      const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='van-intake.csv'; a.click(); URL.revokeObjectURL(a.href);
      resultEl.innerHTML='<span class="ok">CSV ì €ì¥ ì™„ë£Œ</span>';
    };

    // JSON ë³µì‚¬
    document.getElementById('btnCopy').onclick=async()=>{
      const d=collect(); const err=validate(d); if(err){resultEl.innerHTML='<span class="err">ì˜¤ë¥˜: '+err+'</span>';return;}
      await navigator.clipboard.writeText(JSON.stringify(d,null,2));
      resultEl.innerHTML='<span class="ok">JSON ë³µì‚¬ ì™„ë£Œ</span>';
    };

    // ì´ˆê¸°
    setType('ì‹ë‹¹');
  </script>
</body>
</html>
